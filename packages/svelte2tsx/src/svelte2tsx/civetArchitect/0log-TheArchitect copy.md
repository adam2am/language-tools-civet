Alternative Tokenization: As a potential fix, consider abandoning the dual-pass (scanner + AST walk) approach in collectAnchorsFromTs. Instead, use a single, comprehensive AST walk (ts.forEachChild) and inspect every single node. This is generally more robust than using the low-level scanner. For each node, check its kind to determine if it's a keyword, operator, identifier, etc., and create the anchor. This avoids the scanner's statefulness issue entirely.